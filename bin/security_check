#!/usr/bin/env bash
# Script de verificaciÃ³n de seguridad antes de commit

echo "ðŸ” VERIFICACIÃ“N DE SEGURIDAD"
echo "=============================="
echo ""

# 1. Verificar archivos sensibles
echo "1. Verificando archivos sensibles NO rastreados:"
SENSITIVE_FILES=$(git ls-files 2>/dev/null | grep -E "(master\.key|\.env$|/secrets$)" || true)
if [ -n "$SENSITIVE_FILES" ]; then
  echo "   âŒ ALERTA: Archivos sensibles encontrados en git!"
  echo "$SENSITIVE_FILES"
  exit 1
else
  echo "   âœ… No hay archivos sensibles rastreados"
fi
echo ""

# 2. Verificar master.key
echo "2. Verificando que master.key existe pero estÃ¡ ignorado:"
if [ -f config/master.key ]; then
  echo "   âœ… config/master.key existe"
  if git check-ignore config/master.key > /dev/null 2>&1; then
    echo "   âœ… config/master.key estÃ¡ en .gitignore"
  else
    echo "   âŒ ALERTA: config/master.key NO estÃ¡ ignorado!"
    exit 1
  fi
else
  echo "   âš ï¸  config/master.key no existe"
fi
echo ""

# 3. Verificar .env.example
echo "3. Verificando .env.example:"
if [ -f .env.example ]; then
  echo "   âœ… .env.example existe (plantilla para otros devs)"
else
  echo "   âš ï¸  .env.example no existe (recomendado crearlo)"
fi
echo ""

# 4. Verificar database.yml
echo "4. Verificando database.yml:"
if grep -E "password:\s*['\"]" config/database.yml > /dev/null 2>&1; then
  echo "   âŒ ALERTA: ContraseÃ±a hardcodeada encontrada!"
  exit 1
else
  echo "   âœ… No hay contraseÃ±as hardcodeadas"
fi
echo ""

# 5. Mostrar archivos que se van a subir
echo "5. Archivos que se van a subir:"
git status --short 2>/dev/null | head -20 || echo "   No es un repositorio git"
echo ""

echo "=============================="
echo "âœ… VerificaciÃ³n completada - SEGURO PARA COMMIT"
echo "=============================="

